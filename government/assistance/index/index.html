<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="dark" />
  <meta name="theme-color" content="#0a1020" />
  <title>Mycelial Portals · Constellation TOC</title>
  <!-- Inline favicon + mask icons (data URIs) -->
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Cdefs%3E%3CradialGradient id='g' cx='50%25' cy='40%25' r='60%25'%3E%3Cstop offset='0%25' stop-color='%23bfe2ff'/%3E%3Cstop offset='100%25' stop-color='%230a1020'/%3E%3C/ radialGradient%3E%3C/defs%3E%3Crect width='64' height='64' fill='url(%23g)'/%3E%3Ccircle cx='20' cy='22' r='3' fill='%23e6f0ff'/%3E%3Ccircle cx='44' cy='18' r='2.5' fill='%23e6f0ff'/%3E%3Ccircle cx='50' cy='34' r='2' fill='%23e6f0ff'/%3E%3Cpath d='M20 22L44 18L50 34' stroke='%239fd2ff' stroke-width='2' stroke-linecap='round'/%3E%3C/svg%3E" />
  <link rel="apple-touch-icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAACXBIWXMAAAsSAAALEgHS3X78AAAAVklEQVR4nO3QMQEAAAgDoPvf0CUoQmLw3gQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHgG0QAAW3wC5c4AAAAASUVORK5CYII=" />
  <meta property="og:title" content="Constellation TOC" />
  <meta property="og:description" content="A sleek, offline‑friendly constellation portal with animated starfield and mycelial cards." />
  <meta property="og:image" content="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 630'%3E%3Crect width='1200' height='630' fill='%230a1020'/%3E%3Ccircle cx='220' cy='210' r='8' fill='%23e6f0ff'/%3E%3Ccircle cx='980' cy='180' r='7' fill='%23e6f0ff'/%3E%3Ccircle cx='1040' cy='380' r='6' fill='%23e6f0ff'/%3E%3Cpath d='M220 210L980 180L1040 380' stroke='%239fd2ff' stroke-width='6' stroke-linecap='round'/%3E%3Ctext x='80' y='540' fill='%23bfe2ff' font-family='Inter,Segoe UI,Arial' font-size='72' font-weight='700'%3EConstellation TOC%3C/text%3E%3C/svg%3E" />
  <style>
    :root{
      --bg:#06070d; --fg:#e6f0ff; --muted:#a1b3d6; --card:#0b0f1a99; --accent:#9fd2ff; --glow:#4da3ff44; --ring:#7cc0ff; --focus:#b7e1ff; --radius: 20px;
      --shadow: 0 10px 30px rgba(0,0,0,.5), 0 0 60px var(--glow);
      --density: 260; /* star count baseline */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{ margin:0; background: radial-gradient(1200px 800px at 70% -10%, #0b1221 0%, #070a14 40%, var(--bg) 85%); color:var(--fg); font: 500 16px/1.6 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji"; overflow-x:hidden }

    .sky{ position:fixed; inset:0; z-index:-2; pointer-events:none; filter: drop-shadow(0 0 6px #8ecbff44) }
    .constellations{ position:fixed; inset:0; z-index:-1; pointer-events:none; opacity:.6 }
    .constellations line{ stroke:#9bd0ff; stroke-width:1.2; stroke-linecap:round; filter: drop-shadow(0 0 4px #9bd0ff); stroke-dasharray: 4 6; animation: twinkle 6s ease-in-out infinite }
    .constellations circle{ fill:#cfe7ff; filter: drop-shadow(0 0 8px #d8eeff); animation: twinkle 5s ease-in-out infinite }
    @keyframes twinkle{ 0%,100%{opacity:.9} 50%{opacity:.35} }

    header{ width:min(1100px, 92vw); margin: clamp(18px, 2.8vh, 40px) auto 0; padding: 18px 20px; border-radius: var(--radius); backdrop-filter: blur(8px) saturate(120%); background: linear-gradient(180deg, #0a0f1b99, #080b1499); border: 1px solid #1a2340; box-shadow: var(--shadow) }
    h1{ margin:0 0 6px; font-weight:800; letter-spacing:.4px; line-height:1.15; font-size: clamp(22px, 3.3vw, 44px); background: linear-gradient(90deg, #ffffff, #bfe2ff 60%, #9fd2ff); -webkit-background-clip:text; background-clip:text; color:transparent }
    .sub{color:var(--muted); font-size: clamp(13px, 1.8vw, 16px)}

    .grid{ width:min(1200px, 94vw); margin: 24px auto 120px; display:grid; gap:22px; grid-template-columns: repeat(auto-fit, minmax(270px, 1fr)) }
    .card{ position:relative; isolation:isolate; border-radius: var(--radius); padding:22px 20px 18px; background: radial-gradient(140% 140% at 120% -20%, #0b152caa, #0a0f1a99 45%, #090d1799), linear-gradient(180deg, #0a0f1a88, #0a0f1a44); border:1px solid #152442; box-shadow: var(--shadow); transform-style: preserve-3d; transition: transform .6s ease, border-color .3s, box-shadow .3s, background .4s; overflow:hidden }
    .card:focus-within, .card:focus, .card:hover{ border-color:#25467a; box-shadow: 0 12px 40px rgba(0,0,0,.6), 0 0 100px #83c7ff26 }
    .card:hover{ transform: translateY(-4px) rotateX(2deg) rotateY(-2deg) }
    .card::before{ content:""; position:absolute; inset:-2px; z-index:-1; border-radius: inherit; background: radial-gradient(500px 220px at var(--mx,50%) -20%, #2a7fff22, transparent 60%), radial-gradient(800px 300px at -10% var(--my,50%), #45ffe822, transparent 60%); transition: .25s ease; filter: blur(10px) }
    .badge{ display:inline-flex; align-items:center; gap:8px; font-size:.78rem; letter-spacing:.3px; color:#d8eaff; opacity:.9 }
    .badge svg{ width:18px; height:18px; opacity:.85 }
    .title{ margin:12px 0 6px; font-weight:800; font-size:1.25rem; letter-spacing:.3px }
    .desc{ margin:0 0 14px; color:var(--muted); font-size:.95rem }
    .card a{ position:relative; display:inline-flex; gap:10px; align-items:center; justify-content:center; padding:10px 14px; border-radius: 12px; border:1px solid #1e3b6a; color:#e7f4ff; text-decoration:none; font-weight:700; letter-spacing:.2px; background: linear-gradient(180deg, #0c1830, #0a1224); box-shadow: inset 0 0 0 1px #203b66, 0 6px 20px #0008; transform: translateZ(30px); transition: background .35s, transform .35s, border-color .35s }
    .card a:hover{ background: linear-gradient(180deg, #0f2344, #0b1830); border-color:#2c5699; transform: translateZ(42px) translateY(-1px) }
    .halo{ position:absolute; inset:-1px; border-radius:inherit; z-index:-2; opacity:.6; background: conic-gradient(from 180deg, #2d78ff22, #00ffe822, #00ffd922, #2d78ff22); filter: blur(18px); transform: translateZ(1px) }
    footer{ width:min(1100px,92vw); margin: 18px auto 60px; color: var(--muted); opacity:.85; text-align:center; font-size:.9rem }

    /* Settings floating panel */
    .gear{ position: fixed; right: 14px; bottom: 14px; z-index: 50 }
    .gear button{ border:1px solid #24426f; background: #0b1426; color:#d8eaff; padding:10px 12px; border-radius:14px; font-weight:700; box-shadow:0 10px 30px rgba(0,0,0,.4) }
    .panel{ position: fixed; right: 14px; bottom: 64px; width: 280px; padding: 14px; border-radius: 16px; border:1px solid #1e335a; background:#0a1120ee; backdrop-filter: blur(8px); color:#e6f0ff; box-shadow: var(--shadow); display:none }
    .panel.show{ display:block }
    .row{ display:flex; align-items:center; justify-content:space-between; gap:8px; margin:8px 0 }
    .panel input[type="range"]{ width: 130px }
    .panel label{font-size:.9rem; color:#c6dbff}

    @media (prefers-reduced-motion: reduce){ .card, .card a{ transition:none } .card:hover{ transform:none } .constellations, .sky{ animation:none } }
  </style>
</head>
<body>
  <canvas id="sky" class="sky" aria-hidden="true"></canvas>
  <svg class="constellations" viewBox="0 0 100 100" preserveAspectRatio="none" aria-hidden="true">
    <g id="c1" opacity=".75">
      <circle cx="12" cy="18" r=".6"/><circle cx="24" cy="30" r=".7"/><circle cx="38" cy="22" r=".6"/><circle cx="52" cy="34" r=".7"/>
      <line x1="12" y1="18" x2="24" y2="30"/><line x1="24" y1="30" x2="38" y2="22"/><line x1="38" y1="22" x2="52" y2="34"/>
    </g>
    <g id="c2" opacity=".7">
      <circle cx="72" cy="14" r=".6"/><circle cx="84" cy="26" r=".7"/><circle cx="90" cy="12" r=".55"/>
      <line x1="72" y1="14" x2="84" y2="26"/><line x1="84" y1="26" x2="90" y2="12"/>
    </g>
    <g id="c3" opacity=".75">
      <circle cx="18" cy="70" r=".6"/><circle cx="30" cy="62" r=".6"/><circle cx="46" cy="72" r=".7"/><circle cx="58" cy="62" r=".6"/>
      <line x1="18" y1="70" x2="30" y2="62"/><line x1="30" y1="62" x2="46" y2="72"/><line x1="46" y1="72" x2="58" y2="62"/>
    </g>
    <g id="c4" opacity=".65">
      <circle cx="72" cy="78" r=".6"/><circle cx="86" cy="68" r=".7"/><circle cx="92" cy="84" r=".6"/>
      <line x1="72" y1="78" x2="86" y2="68"/><line x1="86" y1="68" x2="92" y2="84"/>
    </g>
  </svg>

  <header>
    <h1>Constellation TOC</h1>
    <p class="sub">A sleek, parallax starfield with portal cards. Pick a node to open its universe.
    </p>
  </header>

  <main class="grid" id="cards">
    <section class="card" tabindex="0" data-url="https://planetaryrestorationarchive.com/overnight/government/assistance/ga/debates" aria-label="GA Debates &amp; Flash Appeals">
      <div class="halo" aria-hidden="true"></div>
      <div class="badge" aria-hidden="true">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M4 4h16v12H5.17L4 17.17V4z"/><path d="M8 8h8M8 12h5"/></svg>
        Agenda Signal
      </div>
      <h2 class="title">GA Debates &amp; Flash Appeals</h2>
      <p class="desc">Formal “we need help now” indicators—funding &amp; access bottlenecks at a glance.</p>
      <a href="https://planetaryrestorationarchive.com/overnight/government/assistance/ga/debates" target="_blank" rel="noopener">Open Portal →</a>
    </section>

    <section class="card" tabindex="0" data-url="https://planetaryrestorationarchive.com/overnight/government/assistance/drc/outbreak" aria-label="DRC Outbreak Ops">
      <div class="halo" aria-hidden="true"></div>
      <div class="badge" aria-hidden="true">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><circle cx="12" cy="12" r="9"/><path d="M12 7v10M7 12h10"/></svg>
        Health Ops
      </div>
      <h2 class="title">DRC Outbreak Ops</h2>
      <p class="desc">Surge capacity signals (epi, labs, case management) with continuity cues.</p>
      <a href="https://planetaryrestorationarchive.com/overnight/government/assistance/drc/outbreak" target="_blank" rel="noopener">Open Portal →</a>
    </section>

    <section class="card" tabindex="0" data-url="https://planetaryrestorationarchive.com/overnight/government/assistance/aid/worker/safety" aria-label="Aid‑Worker Safety">
      <div class="halo" aria-hidden="true"></div>
      <div class="badge" aria-hidden="true">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M12 2l7 4v6c0 5-3.5 9-7 10-3.5-1-7-5-7-10V6l7-4z"/><path d="M9.5 12l2 2 3.5-3.5"/></svg>
        Protection
      </div>
      <h2 class="title">Aid‑Worker Safety</h2>
      <p class="desc">Public figures and field signals converging on protective access.</p>
      <a href="https://planetaryrestorationarchive.com/overnight/government/assistance/aid/worker/safety" target="_blank" rel="noopener">Open Portal →</a>
    </section>

    <section class="card" tabindex="0" data-url="https://planetaryrestorationarchive.com/overnight/government/assistance/climate/finance/alignment" aria-label="Climate‑Finance Alignment">
      <div class="halo" aria-hidden="true"></div>
      <div class="badge" aria-hidden="true">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M3 12a9 9 0 1 0 18 0 9 9 0 1 0-18 0"/><path d="M8 12h8M12 8v8"/></svg>
        Alignment
      </div>
      <h2 class="title">Climate‑Finance Alignment</h2>
      <p class="desc">Mandatory transition planning &amp; fossil‑risk exposure—clarity by design.</p>
      <a href="https://planetaryrestorationarchive.com/overnight/government/assistance/climate/finance/alignment" target="_blank" rel="noopener">Open Portal →</a>
    </section>
  </main>

  <footer>
    Built as a single, offline‑friendly HTML portal. Keyboard: 1‑4 to open portals · Tab to focus · Enter/Space to open. Motion respects <code>prefers-reduced-motion</code>.
  </footer>

  <!-- Floating settings -->
  <div class="gear">
    <button id="gearBtn" aria-controls="settings" aria-expanded="false">⚙️ Settings</button>
  </div>
  <aside id="settings" class="panel" role="dialog" aria-modal="false" aria-labelledby="settingsTitle">
    <h3 id="settingsTitle" style="margin:0 0 6px 0;font-size:1.05rem">Display & Behavior</h3>
    <div class="row"><label for="density">Star density</label><input id="density" type="range" min="80" max="500" step="10" value="260"/></div>
    <div class="row"><label for="opacity">Constellation opacity</label><input id="opacity" type="range" min="0" max="1" step="0.05" value="0.6"/></div>
    <div class="row"><label for="motion">Reduce motion</label><input id="motion" type="checkbox" /></div>
    <div class="row"><label for="target">Open portals in same tab</label><input id="target" type="checkbox" /></div>
  </aside>

  <script>
    // ===== Manifest + Service Worker (created via Blob for true single-file) =====
    (function(){
      try{
        const manifest = { name:"Constellation TOC", short_name:"Constellation", start_url:".", display:"standalone", background_color:"#0a1020", theme_color:"#0a1020", icons:[{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAA...", sizes:"192x192", type:"image/png"}] };
        const mUrl = URL.createObjectURL(new Blob([JSON.stringify(manifest)], {type:'application/manifest+json'}));
        const link = document.createElement('link'); link.rel='manifest'; link.href=mUrl; document.head.appendChild(link);
      }catch(e){ /* noop */ }

      if('serviceWorker' in navigator){
        const swCode = `
          const CACHE = 'constellation-cache-v1';
          self.addEventListener('install', e=>{ self.skipWaiting(); });
          self.addEventListener('activate', e=>{ e.waitUntil((async()=>{ const keys=await caches.keys(); await Promise.all(keys.filter(k=>k!==CACHE).map(k=>caches.delete(k))); })()); self.clients.claim(); });
          self.addEventListener('fetch', e=>{
            const req = e.request;
            if(req.method!=='GET') return;
            e.respondWith((async()=>{
              const cache = await caches.open(CACHE);
              const cached = await cache.match(req);
              if(cached) return cached;
              try{ const res = await fetch(req); if(res.ok){ cache.put(req, res.clone()); } return res; } catch(err){
                // Offline fallback: return the shell if same-origin and HTML
                if(req.headers.get('accept')?.includes('text/html')){
                  const clients = await self.clients.matchAll();
                  const url = clients[0]?.url; if(url){ const r = await fetch(url).catch(()=>null); if(r) return r; }
                }
                return new Response('<!doctype html><title>Offline</title><style>body{font-family:system-ui;background:#0a1020;color:#e6f0ff;display:grid;place-items:center;height:100vh}</style><h1>Offline</h1><p>Content will appear when you reconnect.</p>', {headers:{'content-type':'text/html'}});
              }
            })());
          });`;
        const swUrl = URL.createObjectURL(new Blob([swCode], {type:'text/javascript'}));
        navigator.serviceWorker.register(swUrl).catch(()=>{});
      }
    })();

    // ===== Starfield (animated) =====
    const canvas = document.getElementById('sky');
    const ctx = canvas.getContext('2d');
    let stars = [], w, h, dpr = Math.min(window.devicePixelRatio || 1, 2);
    let STAR_COUNT = +getPref('density') || getComputedStyle(document.documentElement).getPropertyValue('--density');
    STAR_COUNT = +STAR_COUNT || 260;
    function rand(min, max){ return Math.random() * (max - min) + min; }
    function resize(){ w = canvas.width = Math.floor(innerWidth * dpr); h = canvas.height = Math.floor(innerHeight * dpr); canvas.style.width = innerWidth + 'px'; canvas.style.height = innerHeight + 'px'; }
    function makeStars(){ stars = new Array(STAR_COUNT).fill(0).map(()=>({ x: rand(0, w), y: rand(0, h), z: rand(.2, 1.4), r: rand(.4, 1.8) * dpr, vx: rand(-.02, .02), vy: rand(.02, .12) })); }
    function draw(){ ctx.clearRect(0,0,w,h); for(const s of stars){ s.x += s.vx * s.z; s.y += s.vy * s.z; if(s.y > h || s.x < -20 || s.x > w+20){ s.x = rand(0,w); s.y = -10; s.z = rand(.2, 1.4); } const alpha = .65 + .35 * Math.sin((s.x + s.y) * .002); ctx.beginPath(); ctx.arc(s.x, s.y, s.r * s.z, 0, Math.PI*2); ctx.fillStyle = `rgba(200,230,255,${alpha})`; ctx.fill(); } requestAnimationFrame(draw); }
    resize(); makeStars(); if(!prefersReduced()){ draw(); }
    addEventListener('resize', ()=>{ resize(); makeStars(); });

    // ===== Parallax for SVG constellations =====
    const svg = document.querySelector('.constellations');
    const setOpacity = (v)=>{ svg.style.opacity = v }; setOpacity(getPref('opacity') || '0.6');
    document.addEventListener('scroll', ()=>{ const y = window.scrollY || 0; svg.style.transform = `translateY(${y * -0.1}px)`; }, {passive:true});

    // ===== Card interactivity and keyboard shortcuts =====
    const cards = [...document.querySelectorAll('.card')];
    cards.forEach((card, idx)=>{
      card.addEventListener('mousemove', (e)=>{ const r = card.getBoundingClientRect(); const mx = (e.clientX - r.left) / r.width * 100; const my = (e.clientY - r.top) / r.height * 100; card.style.setProperty('--mx', mx+'%'); card.style.setProperty('--my', my+'%'); });
      card.addEventListener('keydown', (e)=>{ if(e.key === 'Enter' || e.key === ' '){ openCard(card); e.preventDefault(); } });
      card.addEventListener('click', (e)=>{ const a = card.querySelector('a'); if(e.target !== a){ a.click(); } });
      // numeric shortcuts 1-9
      document.addEventListener('keydown', (e)=>{ if(document.activeElement.tagName==='INPUT') return; const n = +e.key; if(n && n-1 === idx){ openCard(card); } });
    });
    function openCard(card){ const url = card.getAttribute('data-url'); const same = getPref('target')==='1'; if(same){ location.href = url; } else { window.open(url, '_blank', 'noopener'); } }

    // ===== Settings panel logic + persistence =====
    const panel = document.getElementById('settings');
    const btn = document.getElementById('gearBtn');
    const density = document.getElementById('density');
    const opacity = document.getElementById('opacity');
    const motion = document.getElementById('motion');
    const target = document.getElementById('target');

    btn.addEventListener('click', ()=>{ const show = !panel.classList.contains('show'); panel.classList.toggle('show', show); btn.setAttribute('aria-expanded', String(show)); });
    document.addEventListener('click', (e)=>{ if(panel.classList.contains('show') && !panel.contains(e.target) && e.target!==btn){ panel.classList.remove('show'); btn.setAttribute('aria-expanded','false'); }});

    // load saved prefs
    density.value = getPref('density') || 260; opacity.value = getPref('opacity') || 0.6; motion.checked = getPref('motion')==='1'; target.checked = getPref('target')==='1';
    if(motion.checked){ stopMotion(); }

    density.addEventListener('input', ()=>{ STAR_COUNT = +density.value; savePref('density', STAR_COUNT); makeStars(); });
    opacity.addEventListener('input', ()=>{ setOpacity(opacity.value); savePref('opacity', opacity.value); });
    motion.addEventListener('change', ()=>{ savePref('motion', motion.checked? '1':'0'); motion.checked? stopMotion() : draw(); });
    target.addEventListener('change', ()=>{ savePref('target', target.checked? '1':'0'); });

    function savePref(k,v){ try{ localStorage.setItem('constellation:'+k, v); }catch(e){} }
    function getPref(k){ try{ return localStorage.getItem('constellation:'+k); }catch(e){ return null } }
    function prefersReduced(){ return window.matchMedia && matchMedia('(prefers-reduced-motion: reduce)').matches }
    function stopMotion(){ cancelAnimationFrame(draw); ctx.clearRect(0,0,w,h); }

    // ===== Accessibility: focus outline on keyboard use only =====
    (function(){ let mouse = false; document.addEventListener('mousedown', ()=>{mouse=true; document.body.classList.add('mouse')},{passive:true}); document.addEventListener('keydown', ()=>{mouse=false; document.body.classList.remove('mouse')}); })();
  </script>
</body>
</html>
